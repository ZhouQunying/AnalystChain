# 项目开发规范

> 通用规则见 `.cursorrules`，本文件仅包含项目具体规范

---

## 1. 编码规范（零容忍）

### 必须遵守
- ✅ 类型提示：参数+返回值
- ✅ 文档字符串：Args、Returns、Raises、Example
- ✅ 异常处理：try-except + logging
- ✅ Python PEP 8
- ✅ LangChain最佳实践
- ✅ Print使用规范（参见 `README.md` 编码规范章节）

### 严格禁止
- ❌ emoji（代码/注释/输出/Markdown）
- ❌ "已修复"等冗余注释
- ❌ 除了stage1_macro_knowledge_pipeline.ipynb，其他Notebook禁止引用src（禁止：`from analyst_chain import ...`）
- ❌ 混用print和logger（必须按规范分类使用）
- ❌ 过度设计（用户要A，只做A；觉得B有用？问用户）

### 快速示例

```python
from typing import Optional
import logging

logger = logging.getLogger(__name__)

def get_data(query: str, limit: int = 10) -> Optional[pd.DataFrame]:
    """获取数据

    Args:
        query: 查询字符串
        limit: 返回数量限制

    Returns:
        数据DataFrame，失败时返回None

    Raises:
        ValueError: 当query为空时
    """
    try:
        if not query:
            raise ValueError("query不能为空")
        return fetch(query, limit)
    except Exception as e:
        logger.error(f"获取数据失败：{e}")
        return None
```

---

## 2. 技术决策遵守

参见 [技术决策速查](./tasks/技术决策速查.md)

---

## 3. 测试验证（改什么测什么）

### 测试规则

| 修改内容 | 必须运行的测试 |
|---------|--------------|
| 知识库 | `python tests/test_stage1_knowledge_retrieval.py` |
| Notebook | 1. 完整执行一次 2. 验证输出正确 |

### 禁止行为
- ❌ 只检查语法就声称完成
- ❌ 只验证"能运行"不验证"输出正确"

---

## 4. 任务完成标准

[ ] ipynb完整执行通过
[ ] py导入测试通过
[ ] 代码拆解到src/完成
[ ] 任务文档已更新
[ ] MCP反馈已调用

---

**此规范100%强制，无例外。**
