# 技术决策记录

> 记录项目中的重要技术选择和决策理由

---

## 决策 #001：知识存储方式

**日期：** 2025-12-03
**决策者：** Qunying + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
需要选择知识的存储和检索方式，有三个方案：
1. 只用向量库
2. 只用JSON
3. 向量库 + JSON

### 决策
**使用方案3：向量库 + JSON双存储**

### 理由

**选择方案3的原因：**
- ✅ 向量库：语义检索能力强，适合SubAgent深度检索
- ✅ JSON：结构化存储，方便主Agent快速预览理论框架
- ✅ 互补优势：两种存储方式各司其职
- ✅ 满足DeepAgents的使用场景

**未选择方案1的原因：**
- ❌ 缺少结构化存储，主Agent难以快速了解知识框架

**未选择方案2的原因：**
- ❌ 无法语义检索
- ❌ 必须精确匹配主题名称

### 影响
- Pipeline需要增加LLM提取模块
- 开发时间增加1天
- 需要调用LLM（有成本），但提升知识可用性

---

## 决策 #002：向量库选择

**日期：** 2025-12-03
**决策者：** Zhou + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
需要选择向量数据库，候选：
1. Chroma
2. FAISS
3. Pinecone
4. Weaviate

### 决策
**使用 Chroma**

### 理由
- ✅ LangChain官方推荐
- ✅ 轻量级，适合本地开发
- ✅ 支持持久化
- ✅ API简单易用
- ✅ 免费开源

**未选择FAISS：**
- ❌ 不支持metadata过滤
- ❌ 持久化需要额外处理

**未选择Pinecone/Weaviate：**
- ❌ 需要云服务
- ❌ 有成本

### 影响
- 本地开发更方便
- 无需云服务依赖
- 易于调试和测试

---

## 决策 #003：Embedding模型选择

**日期：** 2025-12-03
**决策者：** Qunying + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
需要选择Embedding模型，候选：
1. sentence-transformers/all-MiniLM-L6-v2（通用英文模型）
2. Qwen/Qwen3-Embedding-0.6B（阿里通义千问，中文优化）
3. OpenAI: text-embedding-ada-002

### 决策
**使用 Qwen3-Embedding-0.6B**

### 理由

**选择Qwen3-Embedding的原因：**
- ✅ 专门针对中文优化，效果优秀
- ✅ 免费离线可用
- ✅ 1024维度，表达能力强
- ✅ 适合中文宏观经济知识库

**未选择all-MiniLM-L6-v2：**
- ❌ 主要针对英文优化
- ✅ 优点：模型小（90MB），速度快
- ❌ 中文效果不如Qwen3

**未选择OpenAI：**
- ❌ 需要API调用
- ❌ 有成本
- ✅ 优点：效果最好但不离线

### 影响
- 首次下载模型约600MB（需等待）
- embedding速度：中等（比all-MiniLM慢，但可接受）
- 中文检索效果显著提升
- 无运行成本

---

## 决策 #004：Agent框架选择

**日期：** 2025-12-03
**决策者：** Zhou + AI助手
**阶段：** 阶段2-3

### 背景
需要选择Multi-Agent框架，候选：
1. DeepAgents（LangChain官方）
2. LangGraph（LangChain官方）
3. AutoGen（Microsoft）
4. CrewAI

### 决策
**使用 DeepAgents**

### 理由
- ✅ LangChain官方新框架
- ✅ 专门设计用于复杂Agent
- ✅ 内置Planning、FileSystem、SubAgent
- ✅ 持久化内存支持
- ✅ 适合投资分析场景

**未选择LangGraph：**
- DeepAgents基于LangGraph构建
- LangGraph更底层，需要更多代码

**未选择AutoGen：**
- ❌ 与LangChain生态不兼容
- ✅ 适合对话式Agent

**未选择CrewAI：**
- ❌ 社区较小
- ❌ 文档不够完善

### 影响
- Agent开发更高效
- 内存管理更简单
- 适合投资分析workflow

---

## 决策 #005：LLM模型选择（用于知识提取）

**日期：** 2025-12-03
**决策者：** Qunying + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
方案3需要使用LLM从PDF/Word/PPT中提取结构化知识，需要选择合适的LLM模型，候选：
1. deepseek-v3（DeepSeek最新模型）
2. deepseek-chat（DeepSeek旧版）
3. qwen-plus（阿里通义千问）
4. qwen-max（阿里通义千问旗舰）
5. qwen3-coder-plus（编程专用）

### 决策
**使用 deepseek-v3**

### 理由

**选择deepseek-v3的原因：**
- ✅ 最新技术（2024年12月发布）
- ✅ 性能接近GPT-4
- ✅ 极具性价比（¥0.45处理51个文件）
- ✅ 中文能力出色
- ✅ 长文本处理能力强

**未选择qwen3-coder-plus：**
- ❌ 专注代码，非通用理解
- ❌ 经济学领域知识较弱
- ❌ 任务类型不匹配

**未选择qwen-max：**
- ❌ 成本高（¥11.5 vs ¥0.45）
- ✅ 优点：效果最好但性价比低

**未选择其他模型：**
- deepseek-chat：不如v3新
- qwen-plus：性能略低于v3

### 影响
- 知识提取质量高
- 成本极低（约¥0.45）
- 中文经济学概念理解准确

---

## 决策模板

### 决策 #XXX：决策标题

**日期：** YYYY-MM-DD
**决策者：** XXX
**阶段：** 阶段X

### 背景
为什么需要做这个决策？

### 决策
最终选择是什么？

### 理由
- ✅ 优点1
- ✅ 优点2
- ❌ 其他方案的缺点

### 影响
这个决策会带来什么影响？

---

[← 返回主任务](./主任务.md)

