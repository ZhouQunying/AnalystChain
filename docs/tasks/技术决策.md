# 技术决策记录

> 记录项目中的重要技术选择和决策理由

---

## 决策 #001：知识存储方式

**日期：** 2024-12-02
**决策者：** Zhou + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
需要选择知识的存储和检索方式，有三个方案：
1. 只用向量库
2. 只用JSON
3. 向量库 + JSON

### 决策
**阶段1：使用向量库（方案1）**
**后期：评估后可升级到方案3**

### 理由

**选择方案1的原因：**
- ✅ 实现简单，快速验证
- ✅ 无需调用LLM，成本低
- ✅ 语义检索能力强
- ✅ 满足当前需求（SubAgent知识检索）

**未选择方案2的原因：**
- ❌ 无法语义检索
- ❌ 必须精确匹配主题名称

**未选择方案3的原因：**
- ❌ 实现复杂
- ❌ LLM调用成本高
- ⏳ 可以后期升级

### 影响
- Pipeline实现更简单
- 开发周期缩短1-2天
- 成本降低（不调用LLM）

### 后续行动
- [ ] 阶段1完成后评估效果
- [ ] 如果需要结构化知识，升级到方案3

---

## 决策 #002：向量库选择

**日期：** 2024-12-02
**决策者：** Zhou + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
需要选择向量数据库，候选：
1. Chroma
2. FAISS
3. Pinecone
4. Weaviate

### 决策
**使用 Chroma**

### 理由
- ✅ LangChain官方推荐
- ✅ 轻量级，适合本地开发
- ✅ 支持持久化
- ✅ API简单易用
- ✅ 免费开源

**未选择FAISS：**
- ❌ 不支持metadata过滤
- ❌ 持久化需要额外处理

**未选择Pinecone/Weaviate：**
- ❌ 需要云服务
- ❌ 有成本

### 影响
- 本地开发更方便
- 无需云服务依赖
- 易于调试和测试

---

## 决策 #003：Embedding模型选择

**日期：** 2024-12-02
**决策者：** Zhou + AI助手
**阶段：** 阶段1 - 知识基础

### 背景
需要选择Embedding模型，候选：
1. HuggingFace: all-MiniLM-L6-v2
2. HuggingFace: text2vec-base-chinese
3. OpenAI: text-embedding-ada-002

### 决策
**使用 all-MiniLM-L6-v2**

### 理由
- ✅ 免费离线可用
- ✅ 速度快（384维）
- ✅ 中英文效果都不错
- ✅ 模型小（90MB）

**未选择text2vec-base-chinese：**
- ⏳ 可以后期测试对比
- 优点：专门针对中文
- 缺点：模型较大

**未选择OpenAI：**
- ❌ 需要API调用
- ❌ 有成本
- 优点：效果最好

### 影响
- 首次下载模型需要等待
- embedding速度快
- 无运行成本

### 后续行动
- [ ] 测试中文检索效果
- [ ] 如果效果不好，切换到text2vec-base-chinese

---

## 决策 #004：Agent框架选择

**日期：** 2024-12-02
**决策者：** Zhou + AI助手
**阶段：** 阶段2-3

### 背景
需要选择Multi-Agent框架，候选：
1. DeepAgents（LangChain官方）
2. LangGraph（LangChain官方）
3. AutoGen（Microsoft）
4. CrewAI

### 决策
**使用 DeepAgents**

### 理由
- ✅ LangChain官方新框架
- ✅ 专门设计用于复杂Agent
- ✅ 内置Planning、FileSystem、SubAgent
- ✅ 持久化内存支持
- ✅ 适合投资分析场景

**未选择LangGraph：**
- DeepAgents基于LangGraph构建
- LangGraph更底层，需要更多代码

**未选择AutoGen：**
- ❌ 与LangChain生态不兼容
- ✅ 适合对话式Agent

**未选择CrewAI：**
- ❌ 社区较小
- ❌ 文档不够完善

### 影响
- Agent开发更高效
- 内存管理更简单
- 适合投资分析workflow

---

## 决策模板

### 决策 #XXX：决策标题

**日期：** YYYY-MM-DD
**决策者：** XXX
**阶段：** 阶段X

### 背景
为什么需要做这个决策？

### 决策
最终选择是什么？

### 理由
- ✅ 优点1
- ✅ 优点2
- ❌ 其他方案的缺点

### 影响
这个决策会带来什么影响？

### 后续行动
- [ ] 需要做什么？

---

[← 返回主任务](./主任务.md)

